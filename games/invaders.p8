pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
-- INVADERS
-- BY ADAM RICHARDSON
player={x=0,y=120,w=11,h=8}
score=0
lives=0
ufo={x=-20,y=10,w=16,h=8}
enemy_ticks=40
ticks=0
enemies={}
pb={
	x=0,
	y=120,
	w=1,
	h=4,
	speed=2,
	active=false}



-->8
function clear_rect(r)
	rectfill(
		r.x,
		r.y,
		r.x+r.w,
		r.y+r.h,0)
end

function update_enemies()
	local next_spr={
		e=5,
		f=4,
		a=2,
		c=0,
		g=8,
		i=6
	}
	for e in all(enemies) do
		clear_rect(e)
		e.s=next_spr[chr(ord("a")+e.s)]
		spr(e.s,e.x,e.y,e.sw,e.sh)
	end
end

function box_collide(r1,r2)
	return (r1.x < r2.x+r2.w) and
		(r1.x+r1.w > r2.x) and
		(r1.y < r2.y+r2.h) and
		(r1.y+r1.h > r2.y)
end

function kill_enemies()
	for e in all(enemies) do
		if box_collide(e,pb) then
			clear_rect(e)
			del(enemies,e)
			return true
		end
	end
	
	return false
end

function kill_ufo()
	if box_collide(pb,ufo) then
		clear_rect(ufo)
		ufo.x=-20
	end
end
-->8
function _init()
	cls()
	-- ufo
	spr(32,ufo.x,ufo.y,2,1)
	
	-- enemies
	for i=0,6 do
		local x=i*16
		spr(4,x,20)
		add(enemies,{
			x=x,
			y=20,
			w=8,
			h=8,
			s=4,
			sw=1,
			sh=1
		})
		spr(0,x,30,2,1)
		add(enemies,{
			x=x,
			y=30,
			w=11,
			h=8,
			s=0,
			sw=2,
			sh=1
		})
		spr(0,x,40,2,1)
		add(enemies,{
			x=x,
			y=40,
			w=11,
			h=8,
			s=0,
			sw=2,
			sh=1
		})
		spr(6,x,50,2,1)
		add(enemies,{
			x=x,
			y=50,
			w=12,
			h=8,
			s=6,
			sw=2,
			sh=1
		})
		spr(6,x,60,2,1)
		add(enemies,{
			x=x,
			y=60,
			w=12,
			h=8,
			s=6,
			sw=2,
			sh=1
		})
	end
	-- player
	spr(10,player.x,player.y,2,1)
	
	-- sheilds
	for i=0,3 do
		spr(34,8+i*32,100,2,2)
	end
end


function _update60()
	ticks+=1
	if ticks>=enemy_ticks then
		ticks=0
		update_enemies()
	end
	
	if btn(0) then
		clear_rect(player)
		player.x-=1
		player.x=max(0,player.x)
		spr(10,player.x,player.y,2,1)
	end
	
	if btn(1) then
		clear_rect(player)
		player.x+=1
		player.x=min(128-player.w,player.x)
		spr(10,player.x,player.y,2,1)
	end
	
	clear_rect(ufo)
	ufo.x+=1
	spr(32,ufo.x,ufo.y,2,1)
	if ufo.x>128 then
		ufo.x=-20
	end
	
	if pb.active then
		clear_rect(pb)
		pb.y-=pb.speed	
		rectfill(
			pb.x,
			pb.y,
			pb.x,
			pb.y+pb.h,11)
		if pb.y<=10 then
			clear_rect(pb)
			pb.active=false
		end
		
		if pget(pb.x,pb.y-1)!=0 then
			clear_rect(pb)
			pb.active=false
			if not kill_enemies() then
				kill_ufo()
			end
		end
	end
	
	if btnp(5) and not pb.active then
		pb.active=true
		pb.y=115
		pb.x=player.x+5
	end
end

function _draw()
	rectfill(0,0,128,10,0)
	-- info
	print("score "..score,45,2,7)
	spr(10,104,0,2,1)
	print("="..lives,116,2,7)
		
	print(stat(1),0,2,7)
end
__gfx__
0070000070000000007000007000000000077000000770000000777700000000000077770000000000000b000000000000000000000000000000000000000000
000700070000000070070007007000000077770000777700077777777770000007777777777000000000bbb00000000000000000000000000000000000000000
007777777000000070777777707000000777777007777770777777777777000077777777777700000000bbb00000000000000000000000000000000000000000
077077707700000077707770777000007707707777077077777007700777000077700770077700000bbbbbbbbb00000000000000000000000000000000000000
77777777777000000777777777000000777777777777777777777777777700007777777777770000bbbbbbbbbbb0000000000000000000000000000000000000
70777777707000000077777770000000070770700070070000777007770000000007700770000000bbbbbbbbbbb0000000000000000000000000000000000000
70700000707000000070000070000000700000070707707007700770077000000077077077000000bbbbbbbbbbb0000000000000000000000000000000000000
00077077000000000700000007000000070000707070070700770000770000007700000000770000bbbbbbbbbbb0000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000088888800000000bbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000888888888800000bbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00888888888888000bbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0880880880880880bbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8888888888888888bbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0088800880088800bbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0008000000008000bbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000bbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000bbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000bbbbbb0000bbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000bbbbb000000bbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000bbbb00000000bbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000bbbb00000000bbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100001f050260502b050000000000000000000000000000000000001e000230002d0002b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000100002a65028650266502465024650206500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
